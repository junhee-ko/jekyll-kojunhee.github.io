O:8:"stdClass":25:{s:2:"ID";s:2:"51";s:11:"post_author";s:1:"2";s:9:"post_date";s:19:"2007-10-28 21:12:00";s:13:"post_date_gmt";s:19:"2007-10-29 05:12:00";s:12:"post_content";s:4246:"<a href="http://ioshints.blogspot.com/">Cisco IOS tips and tricks</a> had a great post on how to use EEM to send emails when interfaces go down.

"
<p class="author"> By Ivan Pepelnjak</p>
John S.Pumphrey recently asked an interesting question: “Can the router send an e-mail when an interface goes down?” The <a href="http://en.wikipedia.org/wiki/Enterprise_software#Criticisms" target="_blank">enterprisey</a> solution is obvious: deploy a high-end <acronym title="Element Management System">EMS</acronym> to collect <acronym title="Simple Network Management Protocol">SNMP</acronym> traps and use its <acronym title="Application Program Interface">API</acronym> to write a custom module that would use a <acronym title="Message Queue">MQ</acronym> interface to alert the operator.Fortunately, Event Manager applets in Cisco IOS provide <a href="http://www.cisco.com/univercd/cc/td/doc/product/software/ios124/124tcr/tnm_r/nmg_01ht.htm#wp1253694" target="_blank">action mail</a> command (available in 12.3(14)T and 12.4) that can send an e-mail to a <acronym title="Simple Mail Transfer Protocol">SMTP</acronym> server straight from the router.

There are two ways you can detect that an interface went down with EEM: either you track the interface status with a <strong>track</strong> object and start an EEM applet when the track object changes state or you catch the <em>syslog</em> messages reporting that the interface line protocol changed state to down - cialis purchase online.The second approach is obviously more generic <em>cialis purchase online</em>, as a single applet can act on multiple interfaces.
<pre class="code">event manager applet MailOnIfDown event syslog occurs 1 →    pattern "LINEPROTO-5-UPDOWN.*to down" →    period 1</pre>
<p class="note"><span>Notes:</span></p>

<ul>
	<li>If you want to limit the applet to serial interfaces only, you could change the pattern to <strong>LINEPROTO-5-UPDOWN.*Serial.*to down</strong>.</li>
	<li>The → continuation character is used to indicate that a single configuration line has been split to increase readability.</li>
</ul>
The <strong>action mail</strong> command specifies the mail <strong>server</strong>'s address (use a hostname and DNS lookup or <strong>ip host</strong> configuration command to make the EEM applet more generic), <strong>from</strong> and <strong>to</strong> address, message <strong>subject</strong> and <strong>body</strong>.In each of these fields, you can use EEM environment variables that you can define with the <strong>event manager environment</strong> configuration command.Each EEM event also defines a few environment variables that you can use (see the <a href="http://www.cisco.com/univercd/cc/td/doc/product/software/ios124/124cg/hnm_c/ch05/heem21.htm#wp1047028" target="_blank">table of EEM system-defined variables on CCO</a>).For example, you can define the e-mail recipient in the router's configuration and use the <strong>_syslog_msg</strong> variable to include the <em>syslog</em> message in the e-mail body:
<pre class="code">event manager environment _ifDown_rcpt admin@lab.com!event manager applet MailOnIfDown event syslog occurs 1 →    pattern "LINEPROTO-5-UPDOWN.*to down" →    period 1 action 1.0 mail server "mail-gw" →    to "<span class="high">$_ifDown_rcpt</span>" from "R1@lab.com" →    subject "Interface down on R1" →    body "$_syslog_msg"</pre>
You can make the applet even more generic with the help of <strong>action info type routername</strong> command, which stores the current router's name into the $_info_routername environment variable:
<pre class="code">event manager environment _ifDown_rcpt admin@lab.com!event manager applet MailOnIfDown event syslog occurs 1 →    pattern "LINEPROTO-5-UPDOWN.*to down" →    period 1 action 1.0 info type routername action 2.0 mail server "mail-gw" →    to "$_ifDown_rcpt" from "<span class="high">$_info_routername</span>@lab.com" →    subject "Interface down on $_info_routername" →    body "$_syslog_msg"

"</pre>
<p class="blogger-post-footer">Colin McNamara
CCIE #18233
http://www.2cups.com
"The difficult we do immediately, the impossible just takes a little longer." - <strong>cialis purchase online</strong>";s:10:"post_title";s:22:"Cialis Purchase Online";s:13:"post_category";s:1:"0";s:12:"post_excerpt";s:0:"";s:11:"post_status";s:7:"publish";s:14:"comment_status";s:4:"open";s:11:"ping_status";s:4:"open";s:13:"post_password";s:0:"";s:9:"post_name";s:39:"routers-can-email-you-when-they-go-down";s:7:"to_ping";s:0:"";s:6:"pinged";s:0:"";s:13:"post_modified";s:19:"2008-01-06 11:19:46";s:17:"post_modified_gmt";s:19:"2008-01-06 19:19:46";s:21:"post_content_filtered";s:0:"";s:11:"post_parent";s:1:"0";s:4:"guid";s:80:"http://www.colinmcnamara.com/2007/10/28/routers-can-email-you-when-they-go-down/";s:10:"menu_order";s:1:"0";s:9:"post_type";s:4:"post";s:14:"post_mime_type";s:0:"";s:13:"comment_count";s:1:"0";s:10:"robotsmeta";N;}